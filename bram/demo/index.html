<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ThumbmarkJS - Advanced Browser Fingerprinting Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid #f0f0f0;
    }

    h1 {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #666;
      font-size: 1rem;
    }

    .fingerprint-id {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      border-radius: 0.75rem;
      margin: 2rem 0;
      text-align: center;
    }

    .fingerprint-id h2 {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .id-value {
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 2rem;
      font-weight: bold;
      word-break: break-all;
      margin-bottom: 1rem;
    }

    .confidence {
      font-size: 1rem;
      opacity: 0.95;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 0.5rem;
      text-align: center;
      border-left: 4px solid #667eea;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: #666;
      font-size: 0.9rem;
    }

    .controls {
      display: flex;
      gap: 1rem;
      margin: 2rem 0;
      flex-wrap: wrap;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
    }

    button:active {
      transform: translateY(0);
    }

    .loading {
      text-align: center;
      padding: 3rem;
      color: #666;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .components {
      margin-top: 2rem;
    }

    .component {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      border-left: 4px solid #667eea;
    }

    .component h3 {
      color: #667eea;
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .entropy-badge {
      background: #667eea;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.8rem;
      font-weight: normal;
    }

    .component pre {
      background: white;
      padding: 1rem;
      border-radius: 0.25rem;
      overflow-x: auto;
      font-size: 0.85rem;
      line-height: 1.5;
      max-height: 400px;
      overflow-y: auto;
    }

    .alert {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      color: #856404;
    }

    .alert.danger {
      background: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }

    .alert.success {
      background: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }

    .detection-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .detection-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      text-align: center;
    }

    .detection-card.detected {
      border-color: #f44336;
      background: #ffebee;
    }

    .detection-card.safe {
      border-color: #4caf50;
      background: #e8f5e9;
    }

    .detection-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }

    .detection-label {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .detection-probability {
      color: #666;
      font-size: 0.9rem;
    }

    .tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #e0e0e0;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      background: none;
      border: none;
      border-radius: 0;
      box-shadow: none;
      color: #666;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .tab:hover {
      transform: none;
      box-shadow: none;
      color: #667eea;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: bold;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üîç ThumbmarkJS</h1>
      <p class="subtitle">Advanced Browser Fingerprinting Demo - Educational Purpose Only</p>
    </header>

    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p>Generating your unique fingerprint...</p>
      <small style="display: block; margin-top: 1rem; color: #999;">
        This may take a few seconds as we collect all signals
      </small>
    </div>

    <div id="result" style="display: none;">
      <!-- Fingerprint ID -->
      <div class="fingerprint-id">
        <h2>Your Visitor ID</h2>
        <div class="id-value" id="visitorId"></div>
        <div class="confidence" id="confidence"></div>
      </div>

      <!-- Stats -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="entropyBits">0</div>
          <div class="stat-label">Bits of Entropy</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="moduleCount">0</div>
          <div class="stat-label">Modules Collected</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="uniqueness">0</div>
          <div class="stat-label">Uniqueness (1 in X)</div>
        </div>
      </div>

      <!-- Detection Results -->
      <div id="detectionResults"></div>

      <!-- Controls -->
      <div class="controls">
        <button onclick="regenerate()">üîÑ Regenerate Fingerprint</button>
        <button onclick="generateDeviceId()">üíª Get Device ID (Cross-Browser)</button>
        <button onclick="copyToClipboard()">üìã Copy Visitor ID</button>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('all')">All Signals</button>
        <button class="tab" onclick="switchTab('hardware')">Hardware Only</button>
        <button class="tab" onclick="switchTab('detection')">Detection</button>
      </div>

      <!-- Components -->
      <div id="tabAll" class="tab-content active">
        <div class="components" id="components"></div>
      </div>

      <div id="tabHardware" class="tab-content">
        <div class="components" id="componentsHardware"></div>
      </div>

      <div id="tabDetection" class="tab-content">
        <div class="components" id="componentsDetection"></div>
      </div>
    </div>
  </div>

  <script src="thumbmark.js"></script>
  <script>
    let currentFingerprint = null;

    async function displayFingerprint() {
      try {
        // Generate complete fingerprint
        const result = await ThumbmarkJS.generateComplete();
        currentFingerprint = result;

        // Hide loading, show result
        document.getElementById('loading').style.display = 'none';
        document.getElementById('result').style.display = 'block';

        // Display visitor ID
        document.getElementById('visitorId').textContent = result.visitorId;
        document.getElementById('confidence').textContent =
          `Confidence: ${result.confidence.toFixed(1)}% | Entropy: ${result.entropyBits.toFixed(1)} bits`;

        // Stats
        document.getElementById('entropyBits').textContent = result.entropyBits.toFixed(1);
        document.getElementById('moduleCount').textContent = result.metadata.moduleCount;

        // Calculate uniqueness (2^entropy = 1 in X users)
        const uniqueness = Math.pow(2, result.entropyBits);
        const uniquenessStr = uniqueness > 1000000 ?
          (uniqueness / 1000000).toFixed(1) + 'M' :
          uniqueness > 1000 ?
          (uniqueness / 1000).toFixed(1) + 'K' :
          uniqueness.toFixed(0);
        document.getElementById('uniqueness').textContent = uniquenessStr;

        // Display detection results
        displayDetectionResults(result);

        // Display components
        displayComponents(result.components, 'components', null);

        // Display hardware-only
        const hardwareModules = ['canvas', 'webgl', 'screen', 'audio', 'cross-browser'];
        displayComponents(result.components, 'componentsHardware', hardwareModules);

        // Display detection-only
        const detectionModules = ['vpn-detector', 'tor-detector', 'protocols'];
        displayComponents(result.components, 'componentsDetection', detectionModules);

      } catch (error) {
        console.error('Fingerprinting failed:', error);
        document.getElementById('loading').innerHTML =
          `<div class="alert danger">
            <strong>Error:</strong> Failed to generate fingerprint. ${error.message}
          </div>`;
      }
    }

    function displayDetectionResults(result) {
      const detectionDiv = document.getElementById('detectionResults');
      let html = '<h2 style="margin-bottom: 1rem;">Detection Results</h2><div class="detection-results">';

      // VPN Detection
      const vpn = result.components['vpn-detector'];
      if (vpn) {
        const vpnDetected = vpn.probability > 0.5;
        html += `
          <div class="detection-card ${vpnDetected ? 'detected' : 'safe'}">
            <div class="detection-icon">${vpnDetected ? 'üõ°Ô∏è' : '‚úÖ'}</div>
            <div class="detection-label">VPN Detection</div>
            <div class="detection-probability">
              ${vpnDetected ? 'Likely using VPN' : 'No VPN detected'}
              (${(vpn.probability * 100).toFixed(0)}% probability)
            </div>
          </div>
        `;
      }

      // Tor Detection
      const tor = result.components['tor-detector'];
      if (tor) {
        const torDetected = tor.probability > 0.7;
        html += `
          <div class="detection-card ${torDetected ? 'detected' : 'safe'}">
            <div class="detection-icon">${torDetected ? 'üßÖ' : '‚úÖ'}</div>
            <div class="detection-label">Tor Detection</div>
            <div class="detection-probability">
              ${torDetected ? 'Likely Tor Browser' : 'Not Tor Browser'}
              (${(tor.probability * 100).toFixed(0)}% probability)
            </div>
          </div>
        `;
      }

      // Protocol Detection
      const protocols = result.components['protocols'];
      if (protocols) {
        html += `
          <div class="detection-card">
            <div class="detection-icon">üì±</div>
            <div class="detection-label">Installed Apps</div>
            <div class="detection-probability">
              ${protocols.count} applications detected
            </div>
          </div>
        `;
      }

      html += '</div>';
      detectionDiv.innerHTML = html;
    }

    function displayComponents(components, containerId, filter) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      for (const [name, data] of Object.entries(components)) {
        // Filter if specified
        if (filter && !filter.includes(name)) continue;
        if (data === null) continue;

        const component = document.createElement('div');
        component.className = 'component';

        const entropy = getEntropyForModule(name);
        const entropyBadge = entropy > 0 ?
          `<span class="entropy-badge">${entropy.toFixed(1)} bits</span>` : '';

        component.innerHTML = `
          <h3>
            ${formatComponentName(name)}
            ${entropyBadge}
          </h3>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        `;

        container.appendChild(component);
      }

      if (container.children.length === 0) {
        container.innerHTML = '<p style="color: #999; text-align: center; padding: 2rem;">No data available</p>';
      }
    }

    function getEntropyForModule(name) {
      const entropyMap = {
        'canvas': 5.7,
        'webgl': 7.0,
        'audio': 4.5,
        'fonts': 5.0,
        'navigator': 8.0,
        'screen': 5.0,
        'timezone': 3.5,
        'protocols': 6.0,
        'cross-browser': 15.0
      };
      return entropyMap[name] || 0;
    }

    function formatComponentName(name) {
      return name
        .split('-')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    }

    function switchTab(tab) {
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');

      // Update tab content
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
    }

    async function regenerate() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('result').style.display = 'none';
      await displayFingerprint();
    }

    async function generateDeviceId() {
      const result = await ThumbmarkJS.generateDeviceId();
      alert(`Device ID (Cross-Browser): ${result.components['cross-browser'].deviceId}\n\nConfidence: ${result.components['cross-browser'].confidence}%\n\nThis ID should remain the same across different browsers on this device.`);
    }

    function copyToClipboard() {
      navigator.clipboard.writeText(currentFingerprint.visitorId);
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '‚úì Copied!';
      setTimeout(() => {
        btn.textContent = originalText;
      }, 2000);
    }

    // Auto-start
    displayFingerprint();
  </script>
</body>
</html>
